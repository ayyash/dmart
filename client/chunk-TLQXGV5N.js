import{a as J,b as Q,c as z,d as K,e as W,f as X,g as Y,h as Z,j as ee,k as te,l as re,m as oe}from"./chunk-2KU2ND3K.js";import{c as p}from"./chunk-HP5CWBH6.js";import{e as $}from"./chunk-KAV35UAE.js";import{a as ie}from"./chunk-NFFTWQX6.js";import{$a as P,A as F,D as U,E as T,Fa as c,Ha as u,P as r,Q as f,S as E,Va as G,a as v,aa as w,b as j,ba as M,i as d,ia as a,ja as l,ka as L,kb as y,lb as H,n as V,na as O,oa as k,s as B,sa as N,sb as q,w as I,xa as g,ya as S,yb as s,z as m,za as D}from"./chunk-MOKJMFP6.js";var ne=()=>{let i=F(p),e=F(y);return i.stateItem$.pipe(d(t=>(t&&e.navigateByUrl(i.redirectUrl||s.Basic.defaultRoute),!0)))};var C=i=>{let e=i.records?.length?i.records[0]:null;return v(v({},e),e?.attributes)};var h=class{static NewInstance(e){return{email:e.email,username:e.shortname,displayname:ie.MapLanguage(e.displayname),type:e.type,isEmailVerified:e.is_email_verified,isMobileVerified:e.is_msisdn_verified,mobile:e.msisdn,roles:e.roles,forcePasswordChange:e.force_password_change}}};var b=class{static NewInstance(e){let t=JSON.parse(atob(e.access_token.split(".")[1]));return t?{accessToken:e.access_token,expiresAt:t.expires*1e3,payload:h.NewInstance(e)}:null}static PrepAccessToken(e,t){return{shortname:e,password:t}}static PrepReset(e,t){return{Code:t,Password:e}}static PrepSave(e){return`newPassword=${e.newPassword}&oldPassword=${e.password}`}static PrepForgot(e){return`email=${e}`}};var A=class i{constructor(e,t){this._http=e;this.authState=t}_detailsUrl=s.API.profile.details;GetProfile(e){return this._http.get(this._detailsUrl).pipe(d(t=>{let o=h.NewInstance(C(t)),n=j(v({},e),{payload:o});return this.authState.SaveSession(n),n}))}static \u0275fac=function(t){return new(t||i)(m(P),m(p))};static \u0275prov=I({token:i,factory:i.\u0275fac,providedIn:"root"})};var R=class i{constructor(e,t,o){this.http=e;this.authState=t;this.profileService=o;_seqlog("authservices construct")}_loginUrl=s.API.auth.login;Login(e,t){let o=b.PrepAccessToken(e,t);return this.http.post(this._loginUrl,o).pipe(d(n=>{let _=b.NewInstance(C(n));return this.authState.SaveSession(_)}),B(n=>this.profileService.GetProfile(n)))}Logout(){}static \u0275fac=function(t){return new(t||i)(m(P),m(p),m(A))};static \u0275prov=I({token:i,factory:i.\u0275fac,providedIn:"root"})};var x=class i{constructor(e,t,o,n,_){this.toast=e;this.fb=t;this.router=o;this.authState=n;this.authService=_}loginForm;forceValidation;ngOnInit(){this.loginForm=this.fb.group({username:[],password:[]})}login(){if(this.forceValidation=!1,this.toast.Hide(),this.loginForm.valid){let e=this.loginForm.value;this.authService.Login(e.username,e.password).pipe(V(t=>this.toast.HandleUiError(t))).subscribe({next:t=>{_attn(t),t&&this.router.navigateByUrl(this.authState.redirectUrl||s.Basic.defaultRoute)}})}else this.forceValidation=!0,this.toast.ShowError("INVALID_FORM",{extracss:"error"})}static \u0275fac=function(t){return new(t||i)(f(te),f(Z),f(y),f(p),f(R))};static \u0275cmp=E({type:i,selectors:[["ng-component"]],decls:26,vars:29,consts:[["password",""],[1,"singlepage"],[1,"container"],["novalidate","",3,"submit","formGroup"],[1,"f5","doublespaced","weight-bold"],[1,"doublespaced"],[3,"placeholder"],["type","text","id","username","crinput","","formControlName","username","autocomplete","username",1,"w100",3,"required"],["type","password","id","current-password","autofocus","","autocomplete","current-password","crinput","","formControlName","password",1,"w100",3,"required"],["type","submit",1,"btn-rev","btn-colored","w100","btn-large"],[1,"breath"],["routerLink","/register",1,"weight-bold"]],template:function(t,o){if(t&1){let n=O();a(0,"div",1)(1,"div",2)(2,"form",3),k("submit",function(){return U(n),T(o.login())}),a(3,"h2",4),g(4),c(5,"translate"),l(),a(6,"div",5)(7,"cr-input",6),c(8,"translate"),L(9,"input",7),l()(),a(10,"div",5)(11,"cr-input",6),c(12,"translate"),L(13,"input",8,0),l()(),a(15,"div")(16,"button",9),g(17),c(18,"translate"),l()(),a(19,"div",10),g(20),c(21,"translate"),a(22,"a",11),g(23),c(24,"translate"),l(),g(25,". "),l()()()()}t&2&&(r(2),M("was-validated",o.forceValidation),w("formGroup",o.loginForm),r(2),S(u(5,11,"Login","Login")),r(3),N("placeholder",u(8,14,"Username","Username")),r(2),w("required",!0),r(2),N("placeholder",u(12,17,"Password","Password")),r(2),w("required",!0),r(4),S(u(18,20,"Login","Login")),r(3),D(" ",u(21,23,"New user?","NewUserQuestion")," "),r(3),S(u(24,26,"Register","Register")))},dependencies:[G,q,H,$,ee,K,J,Q,z,Y,W,X,re,oe],encapsulation:2,changeDetection:0})};var et=[{path:"",redirectTo:"/spaces",pathMatch:"full"},{path:"login",component:x,resolve:{login:ne}}];export{et as PublicRoutes};
