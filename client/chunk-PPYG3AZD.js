import{a as X,b as Y,c as Z,d as ee,e as te,f as ie,g as re,h as oe,j as ne,k as ae,l as pe,m as me}from"./chunk-2MWWAZJ2.js";import{c as l}from"./chunk-LESIRYZF.js";import"./chunk-JGFSGBRL.js";import{a as se}from"./chunk-4GN7QOP4.js";import{$a as C,A as L,Ab as R,Ba as y,C as S,Da as u,F as U,Fa as d,H,I as k,R as n,S as g,Va as W,Y as P,Z as q,a as h,b as V,ea as a,fa as s,ga as j,i as f,ja as $,ka as J,kb as A,lb as z,n as B,oa as D,s as G,sb as K,ta as p,ua as w,va as Q,w as I,yb as m,z as c}from"./chunk-QUNHBVRW.js";var le=()=>{let i=L(l),e=L(A);return i.stateItem$.pipe(f(t=>(t&&e.navigateByUrl(i.redirectUrl||m.Basic.defaultRoute),!0)))};var x=class i{constructor(){}ngOnInit(){}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["ng-component"]],standalone:!0,features:[y],decls:3,vars:0,consts:[[1,"page"],[1,"container"]],template:function(t,r){t&1&&(a(0,"div",0)(1,"div",1),p(2," you are logged in "),s()())},encapsulation:2,changeDetection:0})};var N=class i{transform(e,t,r=null,o=null){return r!==null?R.Plural(t,r,e):o!==null?R.Select(t,o,e):R.Get(t,e)}static \u0275fac=function(t){return new(t||i)};static \u0275pipe=U({name:"translate",type:i,pure:!0,standalone:!0})};var _=i=>{let e=i.records?.length?i.records[0]:null;return h(h({},e),e?.attributes)};var v=class{static NewInstance(e){return{email:e.email,username:e.shortname,displayname:se.MapLanguage(e.displayname),type:e.type,isEmailVerified:e.is_email_verified,isMobileVerified:e.is_msisdn_verified,mobile:e.msisdn,roles:e.roles,forcePasswordChange:e.force_password_change}}};var b=class{static NewInstance(e){let t=JSON.parse(atob(e.access_token.split(".")[1]));return t?{accessToken:e.access_token,expiresAt:t.expires*1e3,payload:v.NewInstance(e)}:null}static PrepAccessToken(e,t){return{shortname:e,password:t}}static PrepReset(e,t){return{Code:t,Password:e}}static PrepSave(e){return`newPassword=${e.newPassword}&oldPassword=${e.password}`}static PrepForgot(e){return`email=${e}`}};var E=class i{constructor(e,t){this._http=e;this.authState=t}_detailsUrl=m.API.profile.details;GetProfile(e){return this._http.get(this._detailsUrl).pipe(f(t=>{let r=v.NewInstance(_(t)),o=V(h({},e),{payload:r});return this.authState.SaveSession(o),o}))}static \u0275fac=function(t){return new(t||i)(c(C),c(l))};static \u0275prov=I({token:i,factory:i.\u0275fac,providedIn:"root"})};var T=class i{constructor(e,t,r){this.http=e;this.authState=t;this.profileService=r;_seqlog("authservices construct")}_loginUrl=m.API.auth.login;Login(e,t){let r=b.PrepAccessToken(e,t);return this.http.post(this._loginUrl,r).pipe(f(o=>{let O=b.NewInstance(_(o));return this.authState.SaveSession(O)}),G(o=>this.profileService.GetProfile(o)))}Logout(){}static \u0275fac=function(t){return new(t||i)(c(C),c(l),c(E))};static \u0275prov=I({token:i,factory:i.\u0275fac,providedIn:"root"})};var M=class i{constructor(e,t,r,o,O){this.toast=e;this.fb=t;this.router=r;this.authState=o;this.authService=O}loginForm;forceValidation;ngOnInit(){this.loginForm=this.fb.group({username:[],password:[]})}login(){if(this.forceValidation=!1,this.toast.Hide(),this.loginForm.valid){let e=this.loginForm.value;this.authService.Login(e.username,e.password).pipe(B(t=>this.toast.HandleUiError(t))).subscribe({next:t=>{_attn(t),t&&this.router.navigateByUrl(this.authState.redirectUrl||m.Basic.defaultRoute)}})}else this.forceValidation=!0,this.toast.ShowError("INVALID_FORM",{extracss:"error"})}static \u0275fac=function(t){return new(t||i)(g(ae),g(oe),g(A),g(l),g(T))};static \u0275cmp=S({type:i,selectors:[["ng-component"]],standalone:!0,features:[y],decls:26,vars:29,consts:[["password",""],[1,"singlepage"],[1,"container"],["novalidate","",3,"submit","formGroup"],[1,"f5","doublespaced","weight-bold"],[1,"doublespaced"],[3,"placeholder"],["type","text","id","username","mdinput","","formControlName","username","autocomplete","username",1,"md-input","w100",3,"required"],["type","password","id","current-password","autofocus","","autocomplete","current-password","mdinput","","formControlName","password",1,"md-input","w100",3,"required"],["type","submit",1,"btn-rev","btn-colored","w100","btn-large"],[1,"breath"],["routerLink","/register",1,"weight-bold"]],template:function(t,r){if(t&1){let o=$();a(0,"div",1)(1,"div",2)(2,"form",3),J("submit",function(){return H(o),k(r.login())}),a(3,"h2",4),p(4),u(5,"translate"),s(),a(6,"div",5)(7,"md-input",6),u(8,"translate"),j(9,"input",7),s()(),a(10,"div",5)(11,"md-input",6),u(12,"translate"),j(13,"input",8,0),s()(),a(15,"div")(16,"button",9),p(17),u(18,"translate"),s()(),a(19,"div",10),p(20),u(21,"translate"),a(22,"a",11),p(23),u(24,"translate"),s(),p(25,". "),s()()()()}t&2&&(n(2),q("was-validated",r.forceValidation),P("formGroup",r.loginForm),n(2),w(d(5,11,"Login","LOGIN")),n(3),D("placeholder",d(8,14,"Username","USERNAME")),n(2),P("required",!0),n(2),D("placeholder",d(12,17,"Password","PASSWORD")),n(2),P("required",!0),n(4),w(d(18,20,"Sign in","SIGN_IN")),n(3),Q(" ",d(21,23,"New user?","REGISTER_QUESTION")," "),n(3),w(d(24,26,"Register","REGISTER")))},dependencies:[W,K,z,ne,me,pe,ee,X,Y,Z,re,te,ie,N],encapsulation:2,changeDetection:0})};var at=[{path:"",component:x,title:"SITE_NAME"},{path:"login",component:M,resolve:{login:le}}];export{at as PublicRoutes};
