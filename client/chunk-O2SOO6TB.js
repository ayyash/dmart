import{a as A,d as b}from"./chunk-JBHKJTVI.js";import{A as C,_a as y,a as g,e as h,g as m,i as p,jb as d,m as v,n as I,p as S,w as a,xb as u,yb as c,z as s,zb as _}from"./chunk-ZJ25XDQ3.js";var G=()=>C(o).loadAppConfig(),o=class i{constructor(t,e){this.http=t;this.localConfig=e;_seqlog("ConfigService")}_getUrl=c.API.config.local;config=new h(c);config$=this.config.asObservable();static _config;static get Config(){return this._config||c}NewInstance(t,e){let r=g(g({},c),t);return r.Storage=g({},r.Storage),r.isServed=!0,r.withErrors=e,i._config=r,this.config.next(r),r}loadAppConfig(){return _seqlog("LoadAppConfig"),this.localConfig?(this.NewInstance(this.localConfig,!0),m(!0)):this.http.get(this._getUrl).pipe(p(t=>(this.NewInstance(t,!1),_seqlog("config next"),!0)),I(t=>(this.NewInstance(c,!0),_debug(t,"Error in resolve","e"),m(!0))))}static \u0275fac=function(e){return new(e||i)(s(y),s("localConfig",8))};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};var l=class i{constructor(t){this.configService=t;this._setResetKey()}get ourStorage(){return localStorage}getKey(t,e=!1){return`${o.Config.Storage.Key}${e?"."+_.language:""}.${t}`}_setResetKey(){this.configService.config$.pipe(A("config"),S(t=>t.isServed)).subscribe(t=>{let e=this.getKey(t.Storage.ResetKey),r=this.ourStorage.getItem(e);(!r||r!=="true")&&(this.clear(),this.ourStorage.setItem(e,"true"))})}setItem(t,e,r=o.Config.Storage.Timeout,f=!1){let n={value:e,timestamp:Date.now(),expiresin:r};this.ourStorage.setItem(this.getKey(t,f),JSON.stringify(n))}getItem(t,e=!1){let r=this.getKey(t,e),f=this.ourStorage.getItem(r);if(f){let n=JSON.parse(f);return Date.now()-n.timestamp>n.expiresin*36e5?(this.removeItem(r),null):n.value}return null}removeItem(t,e=!1){this.ourStorage.removeItem(this.getKey(t,e))}setCache(t,e,r=o.Config.Storage.Timeout){this.setItem(t,e,r,!0)}getCache(t){return this.getItem(t,!0)}removeCache(t){this.removeItem(t,!0)}clear(){let t=[];for(let e=0;e<this.ourStorage.length;e++){let r=this.ourStorage.key(e);r?.indexOf(o.Config.Storage.Key)===0&&t.push(r)}t.forEach(e=>this.ourStorage.removeItem(e))}static \u0275fac=function(e){return new(e||i)(s(o))};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};var j=class i extends b{constructor(e,r,f){super();this.configService=e;this.localStorage=r;this.router=f;this.configService.config$.pipe(v(n=>n.isServed)).subscribe({next:()=>{let n=this._GetUser();this.CheckAuth(n)?this.SetState(n):this.Logout(!1)}})}get redirectUrl(){return this.localStorage.getItem(u.Auth.redirectKey)}set redirectUrl(e){this.localStorage.setItem(u.Auth.redirectKey,e)}_SaveUser(e){this.localStorage.setItem(o.Config.Auth.userAccessKey,e,e.expiresAt)}_RemoveUser(){this.localStorage.removeItem(o.Config.Auth.userAccessKey)}_GetUser(){let e=this.localStorage.getItem(o.Config.Auth.userAccessKey);return e&&e.accessToken?e:null}SaveSession(e){return e.accessToken?(this._SaveUser(e),this.SetState(e),e):(this._RemoveUser(),this.RemoveState(),null)}UpdateSession(e){let r=this._GetUser();r?(r.accessToken=e.accessToken,this._SaveUser(r),this.UpdateState(e)):(this._RemoveUser(),this.RemoveState())}CheckAuth(e){return!(!e||!e.accessToken||Date.now()>e.expiresAt)}Logout(e=!1){this.RemoveState(),this._RemoveUser(),e&&this.router.navigateByUrl(u.Auth.loginRoute)}GetToken(){let e=this.currentItem;return this.CheckAuth(e)?e.accessToken:null}static \u0275fac=function(r){return new(r||i)(s(o),s(l),s(d))};static \u0275prov=a({token:i,factory:i.\u0275fac,providedIn:"root"})};export{G as a,o as b,j as c};
